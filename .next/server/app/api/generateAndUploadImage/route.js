"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/generateAndUploadImage/route";
exports.ids = ["app/api/generateAndUploadImage/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "querystring":
/*!******************************!*\
  !*** external "querystring" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("querystring");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("util");

/***/ }),

/***/ "worker_threads":
/*!*********************************!*\
  !*** external "worker_threads" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "node:fs":
/*!**************************!*\
  !*** external "node:fs" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:stream":
/*!******************************!*\
  !*** external "node:stream" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/*!**********************************!*\
  !*** external "node:stream/web" ***!
  \**********************************/
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateAndUploadImage%2Froute&page=%2Fapi%2FgenerateAndUploadImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateAndUploadImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateAndUploadImage%2Froute&page=%2Fapi%2FgenerateAndUploadImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateAndUploadImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var D_ArtDocumentation_2024_ImageEcologySimulation_ecologyAPI_src_app_api_generateAndUploadImage_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/generateAndUploadImage/route.ts */ \"(rsc)/./src/app/api/generateAndUploadImage/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/generateAndUploadImage/route\",\n        pathname: \"/api/generateAndUploadImage\",\n        filename: \"route\",\n        bundlePath: \"app/api/generateAndUploadImage/route\"\n    },\n    resolvedPagePath: \"D:\\\\ArtDocumentation\\\\2024_ImageEcologySimulation\\\\ecologyAPI\\\\src\\\\app\\\\api\\\\generateAndUploadImage\\\\route.ts\",\n    nextConfigOutput,\n    userland: D_ArtDocumentation_2024_ImageEcologySimulation_ecologyAPI_src_app_api_generateAndUploadImage_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/generateAndUploadImage/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZnZW5lcmF0ZUFuZFVwbG9hZEltYWdlJTJGcm91dGUmcGFnZT0lMkZhcGklMkZnZW5lcmF0ZUFuZFVwbG9hZEltYWdlJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGZ2VuZXJhdGVBbmRVcGxvYWRJbWFnZSUyRnJvdXRlLnRzJmFwcERpcj1EJTNBJTVDQXJ0RG9jdW1lbnRhdGlvbiU1QzIwMjRfSW1hZ2VFY29sb2d5U2ltdWxhdGlvbiU1Q2Vjb2xvZ3lBUEklNUNzcmMlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUQlM0ElNUNBcnREb2N1bWVudGF0aW9uJTVDMjAyNF9JbWFnZUVjb2xvZ3lTaW11bGF0aW9uJTVDZWNvbG9neUFQSSZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDOEQ7QUFDM0k7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90cmVuZHMtYWktZ2VuZXJhdG9yLz83YWVjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkQ6XFxcXEFydERvY3VtZW50YXRpb25cXFxcMjAyNF9JbWFnZUVjb2xvZ3lTaW11bGF0aW9uXFxcXGVjb2xvZ3lBUElcXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcZ2VuZXJhdGVBbmRVcGxvYWRJbWFnZVxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvZ2VuZXJhdGVBbmRVcGxvYWRJbWFnZS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2dlbmVyYXRlQW5kVXBsb2FkSW1hZ2VcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL2dlbmVyYXRlQW5kVXBsb2FkSW1hZ2Uvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJEOlxcXFxBcnREb2N1bWVudGF0aW9uXFxcXDIwMjRfSW1hZ2VFY29sb2d5U2ltdWxhdGlvblxcXFxlY29sb2d5QVBJXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGdlbmVyYXRlQW5kVXBsb2FkSW1hZ2VcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2dlbmVyYXRlQW5kVXBsb2FkSW1hZ2Uvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateAndUploadImage%2Froute&page=%2Fapi%2FgenerateAndUploadImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateAndUploadImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/generateAndUploadImage/route.ts":
/*!*****************************************************!*\
  !*** ./src/app/api/generateAndUploadImage/route.ts ***!
  \*****************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var cloudinary__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! cloudinary */ \"(rsc)/./node_modules/cloudinary/cloudinary.js\");\n/* harmony import */ var cloudinary__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(cloudinary__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! openai */ \"(rsc)/./node_modules/openai/index.mjs\");\n// app/api/generateAndUpload/route.ts\n\n\n\n// ---------- utils ----------\nfunction dedupLower(arr) {\n    const seen = {};\n    const out = [];\n    for (const t of arr || []){\n        const k = String(t ?? \"\").trim().toLowerCase();\n        if (k && !seen[k]) {\n            seen[k] = true;\n            out.push(String(t).trim());\n        }\n    }\n    return out;\n}\nfunction join(arr, sep = \", \") {\n    if (!arr || !Array.isArray(arr) || arr.length === 0) return \"\";\n    return arr.map((s)=>String(s ?? \"\").trim()).filter(Boolean).join(sep);\n}\nfunction asArray(v) {\n    if (Array.isArray(v)) return v.map(String);\n    if (v == null) return [];\n    // comma-separated string support\n    return String(v).split(\",\").map((s)=>s.trim()).filter(Boolean);\n}\n// ---------- clients ----------\nconst openai = new openai__WEBPACK_IMPORTED_MODULE_2__[\"default\"]({\n    apiKey: process.env.OPENAI_API_KEY\n});\ncloudinary__WEBPACK_IMPORTED_MODULE_1__.v2.config({\n    cloud_name: process.env.CLOUDINARY_CLOUD_NAME,\n    api_key: process.env.CLOUDINARY_API_KEY,\n    api_secret: process.env.CLOUDINARY_API_SECRET\n});\n// ---------- route ----------\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        // Log safely\n        try {\n            console.log(\"attempts remix___:\", body, JSON.stringify(body).slice(0, 500));\n        } catch  {\n            console.log(\"attempts remix: [unserializable body]\");\n        }\n        // #### New rich fields ####\n        const prompt = String(body?.prompt ?? \"\");\n        const adjectives = String(body?.adjectives ?? \"\");\n        const styles = asArray(body?.styles);\n        const communities = asArray(body?.communities);\n        const trends = asArray(body?.trends);\n        const descriptions = asArray(body?.descriptions);\n        const parentIds = asArray(body?.parentIds);\n        const people = asArray(body?.people);\n        // support both \"object\" and \"objects\"\n        const objectsArr = asArray(body?.objects ?? body?.object);\n        // #### Back-compat fields (optional) ####\n        const folder = String(body?.folder ?? \"imageEcology\");\n        const communityFallback = String(body?.community ?? \"\");\n        const titleIn = String(body?.title ?? \"\");\n        const userTagsArr = asArray(body?.tags);\n        // Compose a single, high-signal prompt for the LLM → Image generator\n        const userPrompt = [\n            `You are an image prompt engineer crafting a *single* vivid social media image prompt in English. PLease ensure the prompt will follow our content guidelines.`,\n            `Source descriptions (merge meanings, avoid literal collage text):`,\n            ...descriptions.map((d)=>`- ${d}`),\n            \"\",\n            `Desired vibe / tags: ${adjectives || \"—\"}`,\n            styles.length ? `Style cues: ${join(styles)}` : \"\",\n            communities.length || communityFallback ? `Community context: ${join(communities.length ? communities : [\n                communityFallback\n            ])}` : \"\",\n            trends.length ? `Trending motifs: ${join(trends)}` : \"\",\n            people.length ? `including: ${join(people)}` : \"\",\n            \"\",\n            `Constraints:`,\n            `- Unify the scene into one coherent world; not a grid.`,\n            `- If multiple styles are present, harmonize rather than list.`\n        ].filter(Boolean).join(\"\\n\");\n        // Prompt expansion (compact, one-line)\n        const completion = await openai.chat.completions.create({\n            model: \"gpt-4o-mini\",\n            messages: [\n                {\n                    role: \"system\",\n                    content: \"Return a single, compact prompt line suitable for an image model; no preamble; no lists.\"\n                },\n                {\n                    role: \"user\",\n                    content: userPrompt\n                }\n            ],\n            max_tokens: 180,\n            temperature: 0.8\n        });\n        const sentenceRaw = completion.choices?.[0]?.message?.content ?? \"\";\n        const remixedPrompt = sentenceRaw.replaceAll('\"', \"\").trim();\n        const safetySuffix = \"Square image. No text, no UI, no watermark, no signatures.\";\n        console.log(\"makes image from parents: \", sentenceRaw);\n        // Image generation\n        const imageGen = await openai.images.generate({\n            model: \"dall-e-3\",\n            prompt: `${remixedPrompt}\\n${safetySuffix}`.trim(),\n            n: 1,\n            size: \"1024x1024\"\n        });\n        const b64 = imageGen.data?.[0]?.b64_json ?? null;\n        const remoteUrl = imageGen.data?.[0]?.url ?? null;\n        if (!b64 && !remoteUrl) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Image generation returned no data\"\n            }, {\n                status: 502\n            });\n        }\n        const uploadSource = b64 ? `data:image/png;base64,${b64}` : remoteUrl;\n        // Title to store (prefer explicit title, then remixed, then original prompt)\n        const titleToStore = titleIn || remixedPrompt || prompt || \"image\";\n        // Pick one community string to store in context (if arrays present, use first)\n        const communityToStore = communities && communities[0] || communityFallback || \"\";\n        // ---------- Upload to Cloudinary ----------\n        const uploadResult = await cloudinary__WEBPACK_IMPORTED_MODULE_1__.v2.uploader.upload(uploadSource, {\n            folder,\n            context: {\n                alt: titleToStore,\n                caption: titleToStore,\n                parentIds: parentIds.length ? parentIds.join(\",\") : \"\",\n                community: communityToStore\n            },\n            moderation: \"aws_rek:\" + \"explicit_nudity:0.7:\" + \"hate_symbols:0.6:\" + \"suggestive:ignore:\" + \"violence:ignore:\" + \"visually_disturbing:ignore:\" + \"rude_gestures:ignore:\" + \"drugs:ignore:\" + \"tobacco:ignore:\" + \"alcohol:ignore:\" + \"gambling:ignore\"\n        });\n        // Moderation check\n        const moderationArr = uploadResult.moderation;\n        const wasRejected = moderationArr?.some((m)=>m.status === \"rejected\" && m.kind?.startsWith(\"aws_rek\"));\n        if (wasRejected) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"image does not adhere to our policy\"\n            }, {\n                status: 400\n            });\n        }\n        // ---------- Vision enrichment ----------\n        const visionPrompt = `\nYou will be given an image collected in a users social media feed: \"${titleToStore}\".\n\nReturn ONLY minified JSON with these keys:\n{\"title\":\"\",\"caption\":\"\",\"altText\":\"\",\"feeling\":\"\",\"so_me_type\":\"\",\"trend\":\"\",\"style\":\"\",\"tags\":[],\"vibe\":[],\"objects\":[],\"scenes\":[],\"people\":[]}\n\nRules:\n- \"title\": ≤ 7 words, aligned with \"${titleToStore}\" (refine if needed).\n- \"caption\": ≤ 2 sentences.\n- \"altText\": ≤ 15 words, describing neutrally the image.\n- \"so_me_type\": a title that might identify which Social Media Archetype the image might belong to.\n- \"trend\": a title that might identify which viral trend the image belongs to.\n- \"tags\": up to 12 short tags (nouns/adjectives; no hashtags/emojis).\n- \"feeling\": speculate what feelings it might produce / why we look at it.\n- \"objects\": up to 8 concrete things visible.\n- \"style\": sentences describing the image style for reproduction (photograph/illustration/etc., realism, other style notes).\n- \"people\": check if there are faces; describe each; name celebrity if applicable.\n- No extra text; JSON only.`;\n        const vision = await openai.chat.completions.create({\n            model: \"gpt-4o\",\n            temperature: 0.3,\n            response_format: {\n                type: \"json_object\"\n            },\n            max_tokens: 400,\n            messages: [\n                {\n                    role: \"user\",\n                    content: [\n                        {\n                            type: \"text\",\n                            text: visionPrompt\n                        },\n                        {\n                            type: \"image_url\",\n                            image_url: {\n                                url: uploadResult.secure_url\n                            }\n                        }\n                    ]\n                }\n            ]\n        });\n        const raw = vision.choices?.[0]?.message?.content ?? \"{}\";\n        let ai = {};\n        try {\n            ai = JSON.parse(raw);\n        } catch  {\n            ai = {};\n        }\n        const payload = {\n            title: String(ai?.title ?? titleToStore ?? \"\").trim(),\n            caption: String(ai?.caption ?? \"\").trim(),\n            altText: String(ai?.altText ?? \"\").trim(),\n            so_me_type: String(ai?.so_me_type ?? \"\").trim(),\n            feeling: String(ai?.feeling ?? \"\").trim(),\n            trend: String(ai?.trend ?? \"\").trim(),\n            style: String(ai?.style ?? \"\").trim(),\n            people: Array.isArray(ai?.people) ? ai.people.map(String) : [],\n            tags: Array.isArray(ai?.tags) ? ai.tags.map(String) : [],\n            vibe: Array.isArray(ai?.vibe) ? ai.vibe.map(String) : [],\n            objects: Array.isArray(ai?.objects) ? ai.objects.map(String) : [],\n            scenes: Array.isArray(ai?.scenes) ? ai.scenes.map(String) : []\n        };\n        // Merge tags: user adjectives & arrays → vision inference\n        const adjectivesAsTags = asArray(adjectives);\n        const mergedFromVision = dedupLower([\n            ...payload.tags,\n            ...payload.vibe,\n            ...payload.objects,\n            ...payload.scenes,\n            ...objectsArr,\n            ...people,\n            ...styles,\n            ...trends,\n            ...communities\n        ]).slice(0, 25);\n        const finalTags = dedupLower([\n            ...mergedFromVision,\n            ...adjectivesAsTags,\n            ...userTagsArr\n        ]);\n        // Cloudinary expects comma-separated tags when using explicit()\n        const tagsString = finalTags.join(\",\");\n        // ---------- Enrich Cloudinary asset ----------\n        await cloudinary__WEBPACK_IMPORTED_MODULE_1__.v2.uploader.explicit(uploadResult.public_id, {\n            type: \"upload\",\n            tags: tagsString,\n            context: {\n                caption: titleToStore,\n                alt: payload.altText,\n                ai_title: payload.title,\n                ai_style: payload.style,\n                ai_trend: payload.trend,\n                ai_so_me_type: payload.so_me_type,\n                ai_feeling: payload.feeling,\n                ai_vibe: (payload.vibe || []).join(\", \"),\n                ai_objects: (payload.objects || []).slice(0, 5).join(\", \"),\n                community: communityToStore,\n                parentIds: parentIds.join(\",\"),\n                ai_people: payload.people,\n                // also echo inputs for lineage/auditing\n                remix_prompt: remixedPrompt\n            }\n        });\n        // ---------- Response (compatible with your client DTO) ----------\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            url: uploadResult.secure_url,\n            publicId: uploadResult.public_id,\n            title: titleToStore,\n            alt: payload.altText,\n            ai_title: payload.title,\n            ai_vibe: (payload.vibe || []).join(\", \"),\n            ai_objects: (payload.objects || []).slice(0, 5).join(\", \"),\n            ai_style: payload.style,\n            ai_trend: payload.trend,\n            ai_so_me_type: payload.so_me_type,\n            community: communityToStore,\n            tags: finalTags,\n            parentIds: parentIds.length ? parentIds : null,\n            ai_people: payload.people,\n            remixedPrompt,\n            // also return raw inputs for reference\n            inputs: {\n                prompt,\n                adjectives,\n                styles,\n                communities,\n                trends,\n                descriptions,\n                people,\n                objects: objectsArr\n            }\n        });\n    } catch (error) {\n        console.error(\"Generate+Upload error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to generate and upload image\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9nZW5lcmF0ZUFuZFVwbG9hZEltYWdlL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUEscUNBQXFDO0FBQ007QUFDRztBQUNsQjtBQUU1Qiw4QkFBOEI7QUFDOUIsU0FBU0ksV0FBV0MsR0FBYTtJQUMvQixNQUFNQyxPQUE2QixDQUFDO0lBQ3BDLE1BQU1DLE1BQWdCLEVBQUU7SUFDeEIsS0FBSyxNQUFNQyxLQUFLSCxPQUFPLEVBQUUsQ0FBRTtRQUN6QixNQUFNSSxJQUFJQyxPQUFPRixLQUFLLElBQ25CRyxJQUFJLEdBQ0pDLFdBQVc7UUFDZCxJQUFJSCxLQUFLLENBQUNILElBQUksQ0FBQ0csRUFBRSxFQUFFO1lBQ2pCSCxJQUFJLENBQUNHLEVBQUUsR0FBRztZQUNWRixJQUFJTSxJQUFJLENBQUNILE9BQU9GLEdBQUdHLElBQUk7UUFDekI7SUFDRjtJQUNBLE9BQU9KO0FBQ1Q7QUFFQSxTQUFTTyxLQUFLVCxHQUFxQixFQUFFVSxNQUFNLElBQUk7SUFDN0MsSUFBSSxDQUFDVixPQUFPLENBQUNXLE1BQU1DLE9BQU8sQ0FBQ1osUUFBUUEsSUFBSWEsTUFBTSxLQUFLLEdBQUcsT0FBTztJQUM1RCxPQUFPYixJQUNKYyxHQUFHLENBQUMsQ0FBQ0MsSUFBTVYsT0FBT1UsS0FBSyxJQUFJVCxJQUFJLElBQy9CVSxNQUFNLENBQUNDLFNBQ1BSLElBQUksQ0FBQ0M7QUFDVjtBQUVBLFNBQVNRLFFBQVFDLENBQVU7SUFDekIsSUFBSVIsTUFBTUMsT0FBTyxDQUFDTyxJQUFJLE9BQU9BLEVBQUVMLEdBQUcsQ0FBQ1Q7SUFDbkMsSUFBSWMsS0FBSyxNQUFNLE9BQU8sRUFBRTtJQUN4QixpQ0FBaUM7SUFDakMsT0FBT2QsT0FBT2MsR0FDWEMsS0FBSyxDQUFDLEtBQ05OLEdBQUcsQ0FBQyxDQUFDQyxJQUFNQSxFQUFFVCxJQUFJLElBQ2pCVSxNQUFNLENBQUNDO0FBQ1o7QUFFQSxnQ0FBZ0M7QUFDaEMsTUFBTUksU0FBUyxJ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cEIsUUFBUWpFLE9BQU8sSUFBSSxFQUFFLEVBQUVWLEtBQUssQ0FBQyxHQUFHLEdBQUdoQyxJQUFJLENBQUM7WUFDckQwSCxVQUFVZixRQUFRSyxLQUFLO1lBQ3ZCVyxVQUFVaEIsUUFBUUksS0FBSztZQUN2QmEsZUFBZWpCLFFBQVFFLFVBQVU7WUFDakMvRCxXQUFXcUM7WUFDWGpDLE1BQU1tRTtZQUNOOUUsV0FBV0EsVUFBVW5DLE1BQU0sR0FBR21DLFlBQVk7WUFDMUN5RixXQUFXckIsUUFBUW5FLE1BQU07WUFDekIwQjtZQUNBLHVDQUF1QztZQUN2Q2lFLFFBQVE7Z0JBQ05sRztnQkFDQUM7Z0JBQ0FDO2dCQUNBQztnQkFDQUM7Z0JBQ0FDO2dCQUNBRTtnQkFDQUUsU0FBU0Q7WUFDWDtRQUNGO0lBQ0YsRUFBRSxPQUFPc0MsT0FBTztRQUNkbkQsUUFBUW1ELEtBQUssQ0FBQywwQkFBMEJBO1FBQ3hDLE9BQU83RixxREFBWUEsQ0FBQ3lDLElBQUksQ0FDdEI7WUFBRW9ELE9BQU87UUFBc0MsR0FDL0M7WUFBRUMsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90cmVuZHMtYWktZ2VuZXJhdG9yLy4vc3JjL2FwcC9hcGkvZ2VuZXJhdGVBbmRVcGxvYWRJbWFnZS9yb3V0ZS50cz81NTE1Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGFwcC9hcGkvZ2VuZXJhdGVBbmRVcGxvYWQvcm91dGUudHNcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xuaW1wb3J0IHsgdjIgYXMgY2xvdWRpbmFyeSB9IGZyb20gXCJjbG91ZGluYXJ5XCI7XG5pbXBvcnQgT3BlbkFJIGZyb20gXCJvcGVuYWlcIjtcblxuLy8gLS0tLS0tLS0tLSB1dGlscyAtLS0tLS0tLS0tXG5mdW5jdGlvbiBkZWR1cExvd2VyKGFycjogc3RyaW5nW10pIHtcbiAgY29uc3Qgc2VlbjogUmVjb3JkPHN0cmluZywgdHJ1ZT4gPSB7fTtcbiAgY29uc3Qgb3V0OiBzdHJpbmdbXSA9IFtdO1xuICBmb3IgKGNvbnN0IHQgb2YgYXJyIHx8IFtdKSB7XG4gICAgY29uc3QgayA9IFN0cmluZyh0ID8/IFwiXCIpXG4gICAgICAudHJpbSgpXG4gICAgICAudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoayAmJiAhc2VlbltrXSkge1xuICAgICAgc2VlbltrXSA9IHRydWU7XG4gICAgICBvdXQucHVzaChTdHJpbmcodCkudHJpbSgpKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIG91dDtcbn1cblxuZnVuY3Rpb24gam9pbihhcnI/OiBzdHJpbmdbXSB8IG51bGwsIHNlcCA9IFwiLCBcIikge1xuICBpZiAoIWFyciB8fCAhQXJyYXkuaXNBcnJheShhcnIpIHx8IGFyci5sZW5ndGggPT09IDApIHJldHVybiBcIlwiO1xuICByZXR1cm4gYXJyXG4gICAgLm1hcCgocykgPT4gU3RyaW5nKHMgPz8gXCJcIikudHJpbSgpKVxuICAgIC5maWx0ZXIoQm9vbGVhbilcbiAgICAuam9pbihzZXApO1xufVxuXG5mdW5jdGlvbiBhc0FycmF5KHY6IHVua25vd24pOiBzdHJpbmdbXSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHYpKSByZXR1cm4gdi5tYXAoU3RyaW5nKTtcbiAgaWYgKHYgPT0gbnVsbCkgcmV0dXJuIFtdO1xuICAvLyBjb21tYS1zZXBhcmF0ZWQgc3RyaW5nIHN1cHBvcnRcbiAgcmV0dXJuIFN0cmluZyh2KVxuICAgIC5zcGxpdChcIixcIilcbiAgICAubWFwKChzKSA9PiBzLnRyaW0oKSlcbiAgICAuZmlsdGVyKEJvb2xlYW4pO1xufVxuXG4vLyAtLS0tLS0tLS0tIGNsaWVudHMgLS0tLS0tLS0tLVxuY29uc3Qgb3BlbmFpID0gbmV3IE9wZW5BSSh7XG4gIGFwaUtleTogcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVksXG59KTtcblxuY2xvdWRpbmFyeS5jb25maWcoe1xuICBjbG91ZF9uYW1lOiBwcm9jZXNzLmVudi5DTE9VRElOQVJZX0NMT1VEX05BTUUsXG4gIGFwaV9rZXk6IHByb2Nlc3MuZW52LkNMT1VESU5BUllfQVBJX0tFWSxcbiAgYXBpX3NlY3JldDogcHJvY2Vzcy5lbnYuQ0xPVURJTkFSWV9BUElfU0VDUkVULFxufSk7XG5cbi8vIC0tLS0tLS0tLS0gcm91dGUgLS0tLS0tLS0tLVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogUmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKTtcblxuICAgIC8vIExvZyBzYWZlbHlcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coXCJhdHRlbXB0cyByZW1peF9fXzpcIiwgYm9keSwgSlNPTi5zdHJpbmdpZnkoYm9keSkuc2xpY2UoMCwgNTAwKSk7XG4gICAgfSBjYXRjaCB7XG4gICAgICBjb25zb2xlLmxvZyhcImF0dGVtcHRzIHJlbWl4OiBbdW5zZXJpYWxpemFibGUgYm9keV1cIik7XG4gICAgfVxuXG4gICAgLy8gIyMjIyBOZXcgcmljaCBmaWVsZHMgIyMjI1xuICAgIGNvbnN0IHByb21wdDogc3RyaW5nID0gU3RyaW5nKGJvZHk/LnByb21wdCA/PyBcIlwiKTtcbiAgICBjb25zdCBhZGplY3RpdmVzOiBzdHJpbmcgPSBTdHJpbmcoYm9keT8uYWRqZWN0aXZlcyA/PyBcIlwiKTtcbiAgICBjb25zdCBzdHlsZXM6IHN0cmluZ1tdID0gYXNBcnJheShib2R5Py5zdHlsZXMpO1xuICAgIGNvbnN0IGNvbW11bml0aWVzOiBzdHJpbmdbXSA9IGFzQXJyYXkoYm9keT8uY29tbXVuaXRpZXMpO1xuICAgIGNvbnN0IHRyZW5kczogc3RyaW5nW10gPSBhc0FycmF5KGJvZHk/LnRyZW5kcyk7XG4gICAgY29uc3QgZGVzY3JpcHRpb25zOiBzdHJpbmdbXSA9IGFzQXJyYXkoYm9keT8uZGVzY3JpcHRpb25zKTtcbiAgICBjb25zdCBwYXJlbnRJZHM6IHN0cmluZ1tdID0gYXNBcnJheShib2R5Py5wYXJlbnRJZHMpO1xuICAgIGNvbnN0IHBlb3BsZTogc3RyaW5nW10gPSBhc0FycmF5KGJvZHk/LnBlb3BsZSk7XG4gICAgLy8gc3VwcG9ydCBib3RoIFwib2JqZWN0XCIgYW5kIFwib2JqZWN0c1wiXG4gICAgY29uc3Qgb2JqZWN0c0Fycjogc3RyaW5nW10gPSBhc0FycmF5KGJvZHk/Lm9iamVjdHMgPz8gYm9keT8ub2JqZWN0KTtcblxuICAgIC8vICMjIyMgQmFjay1jb21wYXQgZmllbGRzIChvcHRpb25hbCkgIyMjI1xuICAgIGNvbnN0IGZvbGRlcjogc3RyaW5nID0gU3RyaW5nKGJvZHk/LmZvbGRlciA/PyBcImltYWdlRWNvbG9neVwiKTtcbiAgICBjb25zdCBjb21tdW5pdHlGYWxsYmFjazogc3RyaW5nID0gU3RyaW5nKGJvZHk/LmNvbW11bml0eSA/PyBcIlwiKTtcbiAgICBjb25zdCB0aXRsZUluOiBzdHJpbmcgPSBTdHJpbmcoYm9keT8udGl0bGUgPz8gXCJcIik7XG4gICAgY29uc3QgdXNlclRhZ3NBcnI6IHN0cmluZ1tdID0gYXNBcnJheShib2R5Py50YWdzKTtcblxuICAgIC8vIENvbXBvc2UgYSBzaW5nbGUsIGhpZ2gtc2lnbmFsIHByb21wdCBmb3IgdGhlIExMTSDihpIgSW1hZ2UgZ2VuZXJhdG9yXG4gICAgY29uc3QgdXNlclByb21wdCA9IFtcbiAgICAgIGBZb3UgYXJlIGFuIGltYWdlIHByb21wdCBlbmdpbmVlciBjcmFmdGluZyBhICpzaW5nbGUqIHZpdmlkIHNvY2lhbCBtZWRpYSBpbWFnZSBwcm9tcHQgaW4gRW5nbGlzaC4gUExlYXNlIGVuc3VyZSB0aGUgcHJvbXB0IHdpbGwgZm9sbG93IG91ciBjb250ZW50IGd1aWRlbGluZXMuYCxcbiAgICAgIGBTb3VyY2UgZGVzY3JpcHRpb25zIChtZXJnZSBtZWFuaW5ncywgYXZvaWQgbGl0ZXJhbCBjb2xsYWdlIHRleHQpOmAsXG4gICAgICAuLi5kZXNjcmlwdGlvbnMubWFwKChkKSA9PiBgLSAke2R9YCksXG4gICAgICBcIlwiLFxuICAgICAgYERlc2lyZWQgdmliZSAvIHRhZ3M6ICR7YWRqZWN0aXZlcyB8fCBcIuKAlFwifWAsXG4gICAgICBzdHlsZXMubGVuZ3RoID8gYFN0eWxlIGN1ZXM6ICR7am9pbihzdHlsZXMpfWAgOiBcIlwiLFxuICAgICAgY29tbXVuaXRpZXMubGVuZ3RoIHx8IGNvbW11bml0eUZhbGxiYWNrXG4gICAgICAgID8gYENvbW11bml0eSBjb250ZXh0OiAke2pvaW4oXG4gICAgICAgICAgICBjb21tdW5pdGllcy5sZW5ndGggPyBjb21tdW5pdGllcyA6IFtjb21tdW5pdHlGYWxsYmFja11cbiAgICAgICAgICApfWBcbiAgICAgICAgOiBcIlwiLFxuICAgICAgdHJlbmRzLmxlbmd0aCA/IGBUcmVuZGluZyBtb3RpZnM6ICR7am9pbih0cmVuZHMpfWAgOiBcIlwiLFxuICAgICAgcGVvcGxlLmxlbmd0aCA/IGBpbmNsdWRpbmc6ICR7am9pbihwZW9wbGUpfWAgOiBcIlwiLFxuICAgICAgXCJcIixcbiAgICAgIGBDb25zdHJhaW50czpgLFxuICAgICAgYC0gVW5pZnkgdGhlIHNjZW5lIGludG8gb25lIGNvaGVyZW50IHdvcmxkOyBub3QgYSBncmlkLmAsXG4gICAgICBgLSBJZiBtdWx0aXBsZSBzdHlsZXMgYXJlIHByZXNlbnQsIGhhcm1vbml6ZSByYXRoZXIgdGhhbiBsaXN0LmAsXG4gICAgXVxuICAgICAgLmZpbHRlcihCb29sZWFuKVxuICAgICAgLmpvaW4oXCJcXG5cIik7XG5cbiAgICAvLyBQcm9tcHQgZXhwYW5zaW9uIChjb21wYWN0LCBvbmUtbGluZSlcbiAgICBjb25zdCBjb21wbGV0aW9uID0gYXdhaXQgb3BlbmFpLmNoYXQuY29tcGxldGlvbnMuY3JlYXRlKHtcbiAgICAgIG1vZGVsOiBcImdwdC00by1taW5pXCIsIC8vIGNvbXBhY3QgKyBjYXBhYmxlXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJzeXN0ZW1cIixcbiAgICAgICAgICBjb250ZW50OlxuICAgICAgICAgICAgXCJSZXR1cm4gYSBzaW5nbGUsIGNvbXBhY3QgcHJvbXB0IGxpbmUgc3VpdGFibGUgZm9yIGFuIGltYWdlIG1vZGVsOyBubyBwcmVhbWJsZTsgbm8gbGlzdHMuXCIsXG4gICAgICAgIH0sXG4gICAgICAgIHsgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IHVzZXJQcm9tcHQgfSxcbiAgICAgIF0sXG4gICAgICBtYXhfdG9rZW5zOiAxODAsXG4gICAgICB0ZW1wZXJhdHVyZTogMC44LFxuICAgIH0pO1xuXG4gICAgY29uc3Qgc2VudGVuY2VSYXcgPSBjb21wbGV0aW9uLmNob2ljZXM/LlswXT8ubWVzc2FnZT8uY29udGVudCA/PyBcIlwiO1xuICAgIGNvbnN0IHJlbWl4ZWRQcm9tcHQgPSBzZW50ZW5jZVJhdy5yZXBsYWNlQWxsKCdcIicsIFwiXCIpLnRyaW0oKTtcblxuICAgIGNvbnN0IHNhZmV0eVN1ZmZpeCA9XG4gICAgICBcIlNxdWFyZSBpbWFnZS4gTm8gdGV4dCwgbm8gVUksIG5vIHdhdGVybWFyaywgbm8gc2lnbmF0dXJlcy5cIjtcblxuICAgIGNvbnNvbGUubG9nKFwibWFrZXMgaW1hZ2UgZnJvbSBwYXJlbnRzOiBcIiwgc2VudGVuY2VSYXcpO1xuXG4gICAgLy8gSW1hZ2UgZ2VuZXJhdGlvblxuICAgIGNvbnN0IGltYWdlR2VuID0gYXdhaXQgb3BlbmFpLmltYWdlcy5nZW5lcmF0ZSh7XG4gICAgICBtb2RlbDogXCJkYWxsLWUtM1wiLFxuICAgICAgcHJvbXB0OiBgJHtyZW1peGVkUHJvbXB0fVxcbiR7c2FmZXR5U3VmZml4fWAudHJpbSgpLFxuICAgICAgbjogMSxcbiAgICAgIHNpemU6IFwiMTAyNHgxMDI0XCIsXG4gICAgfSk7XG5cbiAgICBjb25zdCBiNjQgPSBpbWFnZUdlbi5kYXRhPy5bMF0/LmI2NF9qc29uID8/IG51bGw7XG4gICAgY29uc3QgcmVtb3RlVXJsID0gaW1hZ2VHZW4uZGF0YT8uWzBdPy51cmwgPz8gbnVsbDtcbiAgICBpZiAoIWI2NCAmJiAhcmVtb3RlVXJsKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6IFwiSW1hZ2UgZ2VuZXJhdGlvbiByZXR1cm5lZCBubyBkYXRhXCIgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMiB9XG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCB1cGxvYWRTb3VyY2UgPSBiNjRcbiAgICAgID8gYGRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCwke2I2NH1gXG4gICAgICA6IChyZW1vdGVVcmwgYXMgc3RyaW5nKTtcblxuICAgIC8vIFRpdGxlIHRvIHN0b3JlIChwcmVmZXIgZXhwbGljaXQgdGl0bGUsIHRoZW4gcmVtaXhlZCwgdGhlbiBvcmlnaW5hbCBwcm9tcHQpXG4gICAgY29uc3QgdGl0bGVUb1N0b3JlID0gdGl0bGVJbiB8fCByZW1peGVkUHJvbXB0IHx8IHByb21wdCB8fCBcImltYWdlXCI7XG5cbiAgICAvLyBQaWNrIG9uZSBjb21tdW5pdHkgc3RyaW5nIHRvIHN0b3JlIGluIGNvbnRleHQgKGlmIGFycmF5cyBwcmVzZW50LCB1c2UgZmlyc3QpXG4gICAgY29uc3QgY29tbXVuaXR5VG9TdG9yZSA9XG4gICAgICAoY29tbXVuaXRpZXMgJiYgY29tbXVuaXRpZXNbMF0pIHx8IGNvbW11bml0eUZhbGxiYWNrIHx8IFwiXCI7XG5cbiAgICAvLyAtLS0tLS0tLS0tIFVwbG9hZCB0byBDbG91ZGluYXJ5IC0tLS0tLS0tLS1cbiAgICBjb25zdCB1cGxvYWRSZXN1bHQgPSBhd2FpdCBjbG91ZGluYXJ5LnVwbG9hZGVyLnVwbG9hZCh1cGxvYWRTb3VyY2UsIHtcbiAgICAgIGZvbGRlcixcbiAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgYWx0OiB0aXRsZVRvU3RvcmUsXG4gICAgICAgIGNhcHRpb246IHRpdGxlVG9TdG9yZSxcbiAgICAgICAgcGFyZW50SWRzOiBwYXJlbnRJZHMubGVuZ3RoID8gcGFyZW50SWRzLmpvaW4oXCIsXCIpIDogXCJcIixcbiAgICAgICAgY29tbXVuaXR5OiBjb21tdW5pdHlUb1N0b3JlLFxuICAgICAgfSxcbiAgICAgIG1vZGVyYXRpb246XG4gICAgICAgIFwiYXdzX3JlazpcIiArXG4gICAgICAgIFwiZXhwbGljaXRfbnVkaXR5OjAuNzpcIiArXG4gICAgICAgIFwiaGF0ZV9zeW1ib2xzOjAuNjpcIiArXG4gICAgICAgIFwic3VnZ2VzdGl2ZTppZ25vcmU6XCIgK1xuICAgICAgICBcInZpb2xlbmNlOmlnbm9yZTpcIiArXG4gICAgICAgIFwidmlzdWFsbHlfZGlzdHVyYmluZzppZ25vcmU6XCIgK1xuICAgICAgICBcInJ1ZGVfZ2VzdHVyZXM6aWdub3JlOlwiICtcbiAgICAgICAgXCJkcnVnczppZ25vcmU6XCIgK1xuICAgICAgICBcInRvYmFjY286aWdub3JlOlwiICtcbiAgICAgICAgXCJhbGNvaG9sOmlnbm9yZTpcIiArXG4gICAgICAgIFwiZ2FtYmxpbmc6aWdub3JlXCIsXG4gICAgfSk7XG5cbiAgICAvLyBNb2RlcmF0aW9uIGNoZWNrXG4gICAgY29uc3QgbW9kZXJhdGlvbkFyciA9ICh1cGxvYWRSZXN1bHQgYXMgYW55KS5tb2RlcmF0aW9uIGFzXG4gICAgICB8IHtcbiAgICAgICAgICBzdGF0dXM6IHN0cmluZztcbiAgICAgICAgICBraW5kOiBzdHJpbmc7XG4gICAgICAgICAgaW5mbz86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gICAgICAgIH1bXVxuICAgICAgfCB1bmRlZmluZWQ7XG5cbiAgICBjb25zdCB3YXNSZWplY3RlZCA9IG1vZGVyYXRpb25BcnI/LnNvbWUoXG4gICAgICAobSkgPT4gbS5zdGF0dXMgPT09IFwicmVqZWN0ZWRcIiAmJiBtLmtpbmQ/LnN0YXJ0c1dpdGgoXCJhd3NfcmVrXCIpXG4gICAgKTtcbiAgICBpZiAod2FzUmVqZWN0ZWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBlcnJvcjogXCJpbWFnZSBkb2VzIG5vdCBhZGhlcmUgdG8gb3VyIHBvbGljeVwiIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyAtLS0tLS0tLS0tIFZpc2lvbiBlbnJpY2htZW50IC0tLS0tLS0tLS1cbiAgICBjb25zdCB2aXNpb25Qcm9tcHQgPSBgXG5Zb3Ugd2lsbCBiZSBnaXZlbiBhbiBpbWFnZSBjb2xsZWN0ZWQgaW4gYSB1c2VycyBzb2NpYWwgbWVkaWEgZmVlZDogXCIke3RpdGxlVG9TdG9yZX1cIi5cblxuUmV0dXJuIE9OTFkgbWluaWZpZWQgSlNPTiB3aXRoIHRoZXNlIGtleXM6XG57XCJ0aXRsZVwiOlwiXCIsXCJjYXB0aW9uXCI6XCJcIixcImFsdFRleHRcIjpcIlwiLFwiZmVlbGluZ1wiOlwiXCIsXCJzb19tZV90eXBlXCI6XCJcIixcInRyZW5kXCI6XCJcIixcInN0eWxlXCI6XCJcIixcInRhZ3NcIjpbXSxcInZpYmVcIjpbXSxcIm9iamVjdHNcIjpbXSxcInNjZW5lc1wiOltdLFwicGVvcGxlXCI6W119XG5cblJ1bGVzOlxuLSBcInRpdGxlXCI6IOKJpCA3IHdvcmRzLCBhbGlnbmVkIHdpdGggXCIke3RpdGxlVG9TdG9yZX1cIiAocmVmaW5lIGlmIG5lZWRlZCkuXG4tIFwiY2FwdGlvblwiOiDiiaQgMiBzZW50ZW5jZXMuXG4tIFwiYWx0VGV4dFwiOiDiiaQgMTUgd29yZHMsIGRlc2NyaWJpbmcgbmV1dHJhbGx5IHRoZSBpbWFnZS5cbi0gXCJzb19tZV90eXBlXCI6IGEgdGl0bGUgdGhhdCBtaWdodCBpZGVudGlmeSB3aGljaCBTb2NpYWwgTWVkaWEgQXJjaGV0eXBlIHRoZSBpbWFnZSBtaWdodCBiZWxvbmcgdG8uXG4tIFwidHJlbmRcIjogYSB0aXRsZSB0aGF0IG1pZ2h0IGlkZW50aWZ5IHdoaWNoIHZpcmFsIHRyZW5kIHRoZSBpbWFnZSBiZWxvbmdzIHRvLlxuLSBcInRhZ3NcIjogdXAgdG8gMTIgc2hvcnQgdGFncyAobm91bnMvYWRqZWN0aXZlczsgbm8gaGFzaHRhZ3MvZW1vamlzKS5cbi0gXCJmZWVsaW5nXCI6IHNwZWN1bGF0ZSB3aGF0IGZlZWxpbmdzIGl0IG1pZ2h0IHByb2R1Y2UgLyB3aHkgd2UgbG9vayBhdCBpdC5cbi0gXCJvYmplY3RzXCI6IHVwIHRvIDggY29uY3JldGUgdGhpbmdzIHZpc2libGUuXG4tIFwic3R5bGVcIjogc2VudGVuY2VzIGRlc2NyaWJpbmcgdGhlIGltYWdlIHN0eWxlIGZvciByZXByb2R1Y3Rpb24gKHBob3RvZ3JhcGgvaWxsdXN0cmF0aW9uL2V0Yy4sIHJlYWxpc20sIG90aGVyIHN0eWxlIG5vdGVzKS5cbi0gXCJwZW9wbGVcIjogY2hlY2sgaWYgdGhlcmUgYXJlIGZhY2VzOyBkZXNjcmliZSBlYWNoOyBuYW1lIGNlbGVicml0eSBpZiBhcHBsaWNhYmxlLlxuLSBObyBleHRyYSB0ZXh0OyBKU09OIG9ubHkuYDtcblxuICAgIGNvbnN0IHZpc2lvbiA9IGF3YWl0IG9wZW5haS5jaGF0LmNvbXBsZXRpb25zLmNyZWF0ZSh7XG4gICAgICBtb2RlbDogXCJncHQtNG9cIixcbiAgICAgIHRlbXBlcmF0dXJlOiAwLjMsXG4gICAgICByZXNwb25zZV9mb3JtYXQ6IHsgdHlwZTogXCJqc29uX29iamVjdFwiIH0sXG4gICAgICBtYXhfdG9rZW5zOiA0MDAsXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7XG4gICAgICAgICAgcm9sZTogXCJ1c2VyXCIsXG4gICAgICAgICAgY29udGVudDogW1xuICAgICAgICAgICAgeyB0eXBlOiBcInRleHRcIiwgdGV4dDogdmlzaW9uUHJvbXB0IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHR5cGU6IFwiaW1hZ2VfdXJsXCIsXG4gICAgICAgICAgICAgIGltYWdlX3VybDogeyB1cmw6IHVwbG9hZFJlc3VsdC5zZWN1cmVfdXJsIGFzIHN0cmluZyB9LFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICB9KTtcblxuICAgIGNvbnN0IHJhdyA9IHZpc2lvbi5jaG9pY2VzPy5bMF0/Lm1lc3NhZ2U/LmNvbnRlbnQgPz8gXCJ7fVwiO1xuICAgIGxldCBhaTogYW55ID0ge307XG4gICAgdHJ5IHtcbiAgICAgIGFpID0gSlNPTi5wYXJzZShyYXcpO1xuICAgIH0gY2F0Y2gge1xuICAgICAgYWkgPSB7fTtcbiAgICB9XG5cbiAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgdGl0bGU6IFN0cmluZyhhaT8udGl0bGUgPz8gdGl0bGVUb1N0b3JlID8/IFwiXCIpLnRyaW0oKSxcbiAgICAgIGNhcHRpb246IFN0cmluZyhhaT8uY2FwdGlvbiA/PyBcIlwiKS50cmltKCksXG4gICAgICBhbHRUZXh0OiBTdHJpbmcoYWk/LmFsdFRleHQgPz8gXCJcIikudHJpbSgpLFxuICAgICAgc29fbWVfdHlwZTogU3RyaW5nKGFpPy5zb19tZV90eXBlID8/IFwiXCIpLnRyaW0oKSxcbiAgICAgIGZlZWxpbmc6IFN0cmluZyhhaT8uZmVlbGluZyA/PyBcIlwiKS50cmltKCksXG4gICAgICB0cmVuZDogU3RyaW5nKGFpPy50cmVuZCA/PyBcIlwiKS50cmltKCksXG4gICAgICBzdHlsZTogU3RyaW5nKGFpPy5zdHlsZSA/PyBcIlwiKS50cmltKCksXG4gICAgICBwZW9wbGU6IEFycmF5LmlzQXJyYXkoYWk/LnBlb3BsZSkgPyBhaS5wZW9wbGUubWFwKFN0cmluZykgOiBbXSxcbiAgICAgIHRhZ3M6IEFycmF5LmlzQXJyYXkoYWk/LnRhZ3MpID8gYWkudGFncy5tYXAoU3RyaW5nKSA6IFtdLFxuICAgICAgdmliZTogQXJyYXkuaXNBcnJheShhaT8udmliZSkgPyBhaS52aWJlLm1hcChTdHJpbmcpIDogW10sXG4gICAgICBvYmplY3RzOiBBcnJheS5pc0FycmF5KGFpPy5vYmplY3RzKSA/IGFpLm9iamVjdHMubWFwKFN0cmluZykgOiBbXSxcbiAgICAgIHNjZW5lczogQXJyYXkuaXNBcnJheShhaT8uc2NlbmVzKSA/IGFpLnNjZW5lcy5tYXAoU3RyaW5nKSA6IFtdLFxuICAgIH07XG5cbiAgICAvLyBNZXJnZSB0YWdzOiB1c2VyIGFkamVjdGl2ZXMgJiBhcnJheXMg4oaSIHZpc2lvbiBpbmZlcmVuY2VcbiAgICBjb25zdCBhZGplY3RpdmVzQXNUYWdzID0gYXNBcnJheShhZGplY3RpdmVzKTtcbiAgICBjb25zdCBtZXJnZWRGcm9tVmlzaW9uID0gZGVkdXBMb3dlcihbXG4gICAgICAuLi5wYXlsb2FkLnRhZ3MsXG4gICAgICAuLi5wYXlsb2FkLnZpYmUsXG4gICAgICAuLi5wYXlsb2FkLm9iamVjdHMsXG4gICAgICAuLi5wYXlsb2FkLnNjZW5lcyxcbiAgICAgIC4uLm9iamVjdHNBcnIsXG4gICAgICAuLi5wZW9wbGUsXG4gICAgICAuLi5zdHlsZXMsXG4gICAgICAuLi50cmVuZHMsXG4gICAgICAuLi5jb21tdW5pdGllcyxcbiAgICBdKS5zbGljZSgwLCAyNSk7XG5cbiAgICBjb25zdCBmaW5hbFRhZ3MgPSBkZWR1cExvd2VyKFtcbiAgICAgIC4uLm1lcmdlZEZyb21WaXNpb24sXG4gICAgICAuLi5hZGplY3RpdmVzQXNUYWdzLFxuICAgICAgLi4udXNlclRhZ3NBcnIsXG4gICAgXSk7XG5cbiAgICAvLyBDbG91ZGluYXJ5IGV4cGVjdHMgY29tbWEtc2VwYXJhdGVkIHRhZ3Mgd2hlbiB1c2luZyBleHBsaWNpdCgpXG4gICAgY29uc3QgdGFnc1N0cmluZyA9IGZpbmFsVGFncy5qb2luKFwiLFwiKTtcblxuICAgIC8vIC0tLS0tLS0tLS0gRW5yaWNoIENsb3VkaW5hcnkgYXNzZXQgLS0tLS0tLS0tLVxuICAgIGF3YWl0IGNsb3VkaW5hcnkudXBsb2FkZXIuZXhwbGljaXQodXBsb2FkUmVzdWx0LnB1YmxpY19pZCwge1xuICAgICAgdHlwZTogXCJ1cGxvYWRcIixcbiAgICAgIHRhZ3M6IHRhZ3NTdHJpbmcsXG4gICAgICBjb250ZXh0OiB7XG4gICAgICAgIGNhcHRpb246IHRpdGxlVG9TdG9yZSxcbiAgICAgICAgYWx0OiBwYXlsb2FkLmFsdFRleHQsXG4gICAgICAgIGFpX3RpdGxlOiBwYXlsb2FkLnRpdGxlLFxuICAgICAgICBhaV9zdHlsZTogcGF5bG9hZC5zdHlsZSxcbiAgICAgICAgYWlfdHJlbmQ6IHBheWxvYWQudHJlbmQsXG4gICAgICAgIGFpX3NvX21lX3R5cGU6IHBheWxvYWQuc29fbWVfdHlwZSxcbiAgICAgICAgYWlfZmVlbGluZzogcGF5bG9hZC5mZWVsaW5nLFxuICAgICAgICBhaV92aWJlOiAocGF5bG9hZC52aWJlIHx8IFtdKS5qb2luKFwiLCBcIiksXG4gICAgICAgIGFpX29iamVjdHM6IChwYXlsb2FkLm9iamVjdHMgfHwgW10pLnNsaWNlKDAsIDUpLmpvaW4oXCIsIFwiKSxcbiAgICAgICAgY29tbXVuaXR5OiBjb21tdW5pdHlUb1N0b3JlLFxuICAgICAgICBwYXJlbnRJZHM6IHBhcmVudElkcy5qb2luKFwiLFwiKSxcbiAgICAgICAgYWlfcGVvcGxlOiBwYXlsb2FkLnBlb3BsZSxcbiAgICAgICAgLy8gYWxzbyBlY2hvIGlucHV0cyBmb3IgbGluZWFnZS9hdWRpdGluZ1xuICAgICAgICByZW1peF9wcm9tcHQ6IHJlbWl4ZWRQcm9tcHQsXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gLS0tLS0tLS0tLSBSZXNwb25zZSAoY29tcGF0aWJsZSB3aXRoIHlvdXIgY2xpZW50IERUTykgLS0tLS0tLS0tLVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICB1cmw6IHVwbG9hZFJlc3VsdC5zZWN1cmVfdXJsLFxuICAgICAgcHVibGljSWQ6IHVwbG9hZFJlc3VsdC5wdWJsaWNfaWQsXG4gICAgICB0aXRsZTogdGl0bGVUb1N0b3JlLFxuICAgICAgYWx0OiBwYXlsb2FkLmFsdFRleHQsXG4gICAgICBhaV90aXRsZTogcGF5bG9hZC50aXRsZSxcbiAgICAgIGFpX3ZpYmU6IChwYXlsb2FkLnZpYmUgfHwgW10pLmpvaW4oXCIsIFwiKSxcbiAgICAgIGFpX29iamVjdHM6IChwYXlsb2FkLm9iamVjdHMgfHwgW10pLnNsaWNlKDAsIDUpLmpvaW4oXCIsIFwiKSxcbiAgICAgIGFpX3N0eWxlOiBwYXlsb2FkLnN0eWxlLFxuICAgICAgYWlfdHJlbmQ6IHBheWxvYWQudHJlbmQsXG4gICAgICBhaV9zb19tZV90eXBlOiBwYXlsb2FkLnNvX21lX3R5cGUsXG4gICAgICBjb21tdW5pdHk6IGNvbW11bml0eVRvU3RvcmUsXG4gICAgICB0YWdzOiBmaW5hbFRhZ3MsIC8vIGFycmF5XG4gICAgICBwYXJlbnRJZHM6IHBhcmVudElkcy5sZW5ndGggPyBwYXJlbnRJZHMgOiBudWxsLFxuICAgICAgYWlfcGVvcGxlOiBwYXlsb2FkLnBlb3BsZSxcbiAgICAgIHJlbWl4ZWRQcm9tcHQsIC8vIGhhbmR5IGZvciBVSS9leHRyYXNcbiAgICAgIC8vIGFsc28gcmV0dXJuIHJhdyBpbnB1dHMgZm9yIHJlZmVyZW5jZVxuICAgICAgaW5wdXRzOiB7XG4gICAgICAgIHByb21wdCxcbiAgICAgICAgYWRqZWN0aXZlcyxcbiAgICAgICAgc3R5bGVzLFxuICAgICAgICBjb21tdW5pdGllcyxcbiAgICAgICAgdHJlbmRzLFxuICAgICAgICBkZXNjcmlwdGlvbnMsXG4gICAgICAgIHBlb3BsZSxcbiAgICAgICAgb2JqZWN0czogb2JqZWN0c0FycixcbiAgICAgIH0sXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkdlbmVyYXRlK1VwbG9hZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6IFwiRmFpbGVkIHRvIGdlbmVyYXRlIGFuZCB1cGxvYWQgaW1hZ2VcIiB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInYyIiwiY2xvdWRpbmFyeSIsIk9wZW5BSSIsImRlZHVwTG93ZXIiLCJhcnIiLCJzZWVuIiwib3V0IiwidCIsImsiLCJTdHJpbmciLCJ0cmltIiwidG9Mb3dlckNhc2UiLCJwdXNoIiwiam9pbiIsInNlcCIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsIm1hcCIsInMiLCJmaWx0ZXIiLCJCb29sZWFuIiwiYXNBcnJheSIsInYiLCJzcGxpdCIsIm9wZW5haSIsImFwaUtleSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfQVBJX0tFWSIsImNvbmZpZyIsImNsb3VkX25hbWUiLCJDTE9VRElOQVJZX0NMT1VEX05BTUUiLCJhcGlfa2V5IiwiQ0xPVURJTkFSWV9BUElfS0VZIiwiYXBpX3NlY3JldCIsIkNMT1VESU5BUllfQVBJX1NFQ1JFVCIsIlBPU1QiLCJyZXF1ZXN0IiwiYm9keSIsImpzb24iLCJjb25zb2xlIiwibG9nIiwiSlNPTiIsInN0cmluZ2lmeSIsInNsaWNlIiwicHJvbXB0IiwiYWRqZWN0aXZlcyIsInN0eWxlcyIsImNvbW11bml0aWVzIiwidHJlbmRzIiwiZGVzY3JpcHRpb25zIiwicGFyZW50SWRzIiwicGVvcGxlIiwib2JqZWN0c0FyciIsIm9iamVjdHMiLCJvYmplY3QiLCJmb2xkZXIiLCJjb21tdW5pdHlGYWxsYmFjayIsImNvbW11bml0eSIsInRpdGxlSW4iLCJ0aXRsZSIsInVzZXJUYWdzQXJyIiwidGFncyIsInVzZXJQcm9tcHQiLCJkIiwiY29tcGxldGlvbiIsImNoYXQiLCJjb21wbGV0aW9ucyIsImNyZWF0ZSIsIm1vZGVsIiwibWVzc2FnZXMiLCJyb2xlIiwiY29udGVudCIsIm1heF90b2tlbnMiLCJ0ZW1wZXJhdHVyZSIsInNlbnRlbmNlUmF3IiwiY2hvaWNlcyIsIm1lc3NhZ2UiLCJyZW1peGVkUHJvbXB0IiwicmVwbGFjZUFsbCIsInNhZmV0eVN1ZmZpeCIsImltYWdlR2VuIiwiaW1hZ2VzIiwiZ2VuZXJhdGUiLCJuIiwic2l6ZSIsImI2NCIsImRhdGEiLCJiNjRfanNvbiIsInJlbW90ZVVybCIsInVybCIsImVycm9yIiwic3RhdHVzIiwidXBsb2FkU291cmNlIiwidGl0bGVUb1N0b3JlIiwiY29tbXVuaXR5VG9TdG9yZSIsInVwbG9hZFJlc3VsdCIsInVwbG9hZGVyIiwidXBsb2FkIiwiY29udGV4dCIsImFsdCIsImNhcHRpb24iLCJtb2RlcmF0aW9uIiwibW9kZXJhdGlvbkFyciIsIndhc1JlamVjdGVkIiwic29tZSIsIm0iLCJraW5kIiwic3RhcnRzV2l0aCIsInZpc2lvblByb21wdCIsInZpc2lvbiIsInJlc3BvbnNlX2Zvcm1hdCIsInR5cGUiLCJ0ZXh0IiwiaW1hZ2VfdXJsIiwic2VjdXJlX3VybCIsInJhdyIsImFpIiwicGFyc2UiLCJwYXlsb2FkIiwiYWx0VGV4dCIsInNvX21lX3R5cGUiLCJmZWVsaW5nIiwidHJlbmQiLCJzdHlsZSIsInZpYmUiLCJzY2VuZXMiLCJhZGplY3RpdmVzQXNUYWdzIiwibWVyZ2VkRnJvbVZpc2lvbiIsImZpbmFsVGFncyIsInRhZ3NTdHJpbmciLCJleHBsaWNpdCIsInB1YmxpY19pZCIsImFpX3RpdGxlIiwiYWlfc3R5bGUiLCJhaV90cmVuZCIsImFpX3NvX21lX3R5cGUiLCJhaV9mZWVsaW5nIiwiYWlfdmliZSIsImFpX29iamVjdHMiLCJhaV9wZW9wbGUiLCJyZW1peF9wcm9tcHQiLCJwdWJsaWNJZCIsImlucHV0cyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/generateAndUploadImage/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/formdata-node","vendor-chunks/ms","vendor-chunks/core-js","vendor-chunks/lodash","vendor-chunks/cloudinary","vendor-chunks/openai","vendor-chunks/cloudinary-core","vendor-chunks/tr46","vendor-chunks/q","vendor-chunks/web-streams-polyfill","vendor-chunks/node-fetch","vendor-chunks/whatwg-url","vendor-chunks/event-target-shim","vendor-chunks/agentkeepalive","vendor-chunks/form-data-encoder","vendor-chunks/webidl-conversions","vendor-chunks/abort-controller","vendor-chunks/humanize-ms"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2FgenerateAndUploadImage%2Froute&page=%2Fapi%2FgenerateAndUploadImage%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2FgenerateAndUploadImage%2Froute.ts&appDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=D%3A%5CArtDocumentation%5C2024_ImageEcologySimulation%5CecologyAPI&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();